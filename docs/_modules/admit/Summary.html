<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>admit.Summary &#8212; ADMIT 1.0.6 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="ADMIT 1.0.6 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ADMIT 1.0.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for admit.Summary</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;.. _Summary-api:</span>

<span class="sd">   **Summary** --- Project summary metadata.</span>
<span class="sd">   -----------------------------------------</span>

<span class="sd">   This module defines the Summary class.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">admit.xmlio.XmlWriter</span> <span class="k">as</span> <span class="nn">XmlWriter</span>
<span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="k">as</span> <span class="nn">et</span>
<span class="kn">import</span> <span class="nn">admit.util.bdp_types</span> <span class="k">as</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">admit.util.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">admit.util.Table</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">admit.util.AdmitLogging</span> <span class="k">import</span> <span class="n">AdmitLogging</span> <span class="k">as</span> <span class="n">logging</span>

<div class="viewcode-block" id="Summary"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary">[docs]</a><span class="k">class</span> <span class="nc">Summary</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Defines and manages the summary metadata for the ADMIT object,</span>
<span class="sd">        which is ingested by ALMA Archive  and also used by data browser.</span>


<span class="sd">        The Summary is metadata provided by the various tasks.  and written</span>
<span class="sd">        to the ADMIT object and admit.xml.  It is used as project information</span>
<span class="sd">        for the ALMA archive to ingest and for the data browser to display.</span>
<span class="sd">        There will be one summary object per FITS cube, which means that</span>
<span class="sd">        for flows with multiple Ingests there can be multiple Summaries.</span>
<span class="sd">        Each entry in the Summary will be a dictionary of </span>

<span class="sd">        `{ key, [ SummaryEntry ]  }` </span>

<span class="sd">        where the value is a list of zero or more SummaryEntry.  The summaryEntry</span>
<span class="sd">        contains the actual data value, the taskname string, the taskid integer,</span>
<span class="sd">        and string task arguments to be displayed in the web page.</span>
<span class="sd">        Each key also has a value type and description which is the same for</span>
<span class="sd">        every entry in the list.  These are retrieved using getType(key)</span>
<span class="sd">        and getDescription(key).  In the case where different tasks</span>
<span class="sd">        or different instances of the same task write to the same key,</span>
<span class="sd">        the new value will be appended:</span>

<span class="sd">        `{ key, [SummaryEntry task1, SummaryEntry task2,...]}`</span>

<span class="sd">        Because they are needed by the ALMA archive, the keys, value types,</span>
<span class="sd">        and description will be strictly defined ahead of time.  Individual ATs</span>
<span class="sd">        will be responsible for providing the actual value data through their</span>
<span class="sd">        summary() method as a dictionary of {key, [value, taskname, taskid]}.</span>
<span class="sd">        ADMIT Summary keywords that map directly to standard FITS keywords</span>
<span class="sd">        shall have their values copied directly from the FITS header (by</span>
<span class="sd">        Ingest_AT).  Below is a draft list, necessarily incomplete until we</span>
<span class="sd">        have all ATs implemented.  Keywords ending in `n` indicate multiple</span>
<span class="sd">        keywords 1 to NAXIS (as in FITS).  The table below summarizes the keys.</span>

<span class="sd">        .. table::</span>
<span class="sd">           :class: borderless</span>
<span class="sd">           </span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           | Key     |   Description              |      Type      |  Typically          |</span>
<span class="sd">           |         |                            |                |  Provided by        |</span>
<span class="sd">           +=========+============================+================+=====================+</span>
<span class="sd">           |FITSNAME | Pathless filename of       |                |                     | </span>
<span class="sd">           |         | FITS cube                  |      string    |  Ingest_AT          |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |OBJECT   | Object name                |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |NAXIS    | Number of Axes             |      integer   |  Ingest_AT/FITS     | </span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |NAXISn   | size of axis n             |      integer   |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CRPIXn   | Reference pixel axis n     |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CRVALn   | axis value at CRPIXn       |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CTYPEn   | axis type                  |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CDELTn   | axis increment             |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CUNITn   | axis unit                  |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |RESTFREQ | rest frequency, Hz         |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |BMAJ     | beam major axis, radians   |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |BMIN     | beam minor axis, radians   |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |BPA      | beam position angle, deg   |      float     |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |BUNIT    | units of pixel values      |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |TELESCOP | telescope name             |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |OBSERVER | observer name              |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |DATE-OBS | date of observation        |      string    |  Ingest_AT/FITS     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |DATAMAX  | maximum data value         |      float     | Ingest_AT or        |</span>
<span class="sd">           |         |                            |                | CubeStats_AT        |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |DATAMIN  | minimum data value         |      float     | Ingest_AT or        |</span>
<span class="sd">           |         |                            |                | CubeStats_AT        |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |DATAMEAN | mean data value            |      float     |  CubeStats_AT       |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |DYNRANGE | dynamic range, equal to    |      float     |  CubeStats_AT       |</span>
<span class="sd">           |         | DATAMAX/CHANRMS            |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CHANRMS  | one-sigma noise in cube    |      float     |  CubeStats_AT       |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |RMSMETHD | method and parameters used |      list      |  CubeStats_AT       |</span>
<span class="sd">           |         | to compute RMS             |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |SPECTRA  | Spectra extracted by       |     list       | CubeSpectrum_AT     |</span>
<span class="sd">           |         | any method                 |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |LINELIST | Table of parameters of     |admit.util.Table| LineID_AT           |</span>
<span class="sd">           |         | identified spectral lines. |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |LINECUBE | Info about any LineCubes   |   list         |  LineCube_AT        |</span>
<span class="sd">           |         | produced (name, channel    |                |                     |</span>
<span class="sd">           |         | range, image name).        |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |CUBESUM  | Info about any CubeSum     |   list         |  CubeSum_AT         |</span>
<span class="sd">           |         | produced                   |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |MOMENTS  | Table of moments computed  |admit.util.Table| Moment_AT           |</span>
<span class="sd">           |         | from the original cube.    |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |PVSLICES |Table of position-velocity  |   list         | PVSlice_AT          |</span>
<span class="sd">           |         |slices computed from        |                |                     |</span>
<span class="sd">           |         |original cube.              |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |PVCORR   |List of PV correlation      |   list         | PVCorr_AT           |</span>
<span class="sd">           |         |diagrams computed from input|                |                     |</span>
<span class="sd">           |         |cube.                       |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |SEGMENTS | List of segments found by  |   list         | LineSegment_AT      |</span>
<span class="sd">           |         | segment-finding algorithm  |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |SOURCES  | Table of sources found by a|admit.util.Table| SFind2D_AT          |</span>
<span class="sd">           |         | feature-finding algorithm  |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |SMOOTH   | Info about any smoothing   |   list         | Smooth_AT           |</span>
<span class="sd">           |         | done to cube.              |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           |OVERLAP  | Overlap integral input and |   list         | OverlapIntegral_AT  |</span>
<span class="sd">           |         | output images information  |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           | PCA     |Principal component analysis|list of         |PrincipalComponent_AT| </span>
<span class="sd">           |         |information.                |admit.util.Table|                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           | PEAKPNT |Peak Point Plot optionally  |   list         | CubeStats_AT        |</span>
<span class="sd">           |         |produced by CubeStats_AT    |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>
<span class="sd">           | VELDEF  |User or ASDM/source.xml     |   list         | Ingest_AT?          |</span>
<span class="sd">           |         |derived source velocity     |                |                     |</span>
<span class="sd">           |         |information (value,         |                |                     |</span>
<span class="sd">           |         |reference frame, etc)       |                |                     |</span>
<span class="sd">           +---------+----------------------------+----------------+---------------------+</span>

<span class="sd">        *Note:* Keys are stored in all lower case.  All key access will change argument to lower case before</span>
<span class="sd">        accessing.</span>

<span class="sd">        .. table::</span>
<span class="sd">           :class: borderless</span>

<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | FORMATS AND EXAMPLES OF COMPLICATED SUMMARIES                                                      |</span>
<span class="sd">           +====================================================================================================+</span>
<span class="sd">           | RMSMETHD: `[[method type, method args], input cube]`                                               |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Examples::                                                                                         |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           |   [[&#39;metabdevmed&#39;], foobar.im]                                                                     |</span>
<span class="sd">           |   [[&#39;robust&#39;, &#39;chauvenet&#39;, 21.3, 123], foobar.im]                                                  |</span>
<span class="sd">           |   [[&#39;robust&#39;, &#39;classic&#39;, &#39;auto&#39;], foobar.im]                                                       |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | SPECTRA: `[x,y, box, axis type, display image, thumbnail image, caption, input cube]`              |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Example::                                                                                          |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           |  [[ &#39;00h47m33.159s&#39;,&#39;-25d17m17.41s&#39;,(10,-10,-20,22),&#39;frequency&#39;,&#39;spect1.svg&#39;,&#39;spect1_thumb.svg&#39;,   |</span>
<span class="sd">           |     &quot;Spectrum at Emission Peak&quot;, foobar.im],                                                       |</span>
<span class="sd">           |  [ +10,-20,(),&#39;velocity&#39;,&#39;spect.svg&#39;,&#39;spect2_thumb.svg&#39;, &quot;Pencil beam spectrum&quot;, foobar.im]]       |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | LINELIST:  [Format same as output from LineList_AT]                                                |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Example::                                                                                          |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | [[&#39;H2CS_103.0405&#39;,  103.04055,&#39;H2CS&#39;, ...],                                                        |</span>
<span class="sd">           | [&#39;NH2CHO_102.0643&#39;,102.06427, &#39;NH2CHO&#39;, ...]]                                                      |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | MOMENTS:  [table of moment data ]                                                                  |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Columns: `[Line UID, Moment value, display image, thumbnail image, caption,  casa image].`         |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | If thumbnail image is not present, an empty string is given.                                       |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Example::                                                                                          |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | [[&#39;H2CS_103.0405&#39;, 0, &#39;foo_mom0.png&#39;, &#39;foo_mom0_thumb.png&#39;, &#39;Moment 0 of H2CS&#39;, &#39;&#39;],               |</span>
<span class="sd">           | [&#39;H2CS_103.0405&#39;, 1, &#39;foo_mom1.svg&#39;, &#39;&#39;, &#39;Moment 1 of H2CS clipped at 3 sigma&#39;, &#39;foobar_mom1.im&#39;]] |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | PVSLICES:                                                                                          |</span>
<span class="sd">           | `[pvslice type, pvslice args, display image, thumbnail image, caption, input cube, output image].` |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           | Example::                                                                                          |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           |  [[&#39;slice&#39;, start, end, width, &#39;slice1.png&#39;, &#39;slice1_thumb.png&#39;,&#39;pvslice of h2co&#39;,&#39;foobar.im&#39;,     | </span>
<span class="sd">           |     &#39;slice.im&#39;],                                                                                   |</span>
<span class="sd">           |  [&#39;slit&#39;, center, length, pa, width, &#39;slit1.png&#39;, &#39;slit1_thumb.png&#39;, &#39;pvslit of h2co&#39;,&#39;foobar.im&#39;, |</span>
<span class="sd">           |     &#39;slit.im&#39;]]                                                                                    |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>
<span class="sd">           | PVCORR:                                                                                            |</span>
<span class="sd">           | `[display image, thumbnail image, caption, input cube, output image].`                             |</span>
<span class="sd">           |                                                                                                    |</span>
<span class="sd">           +----------------------------------------------------------------------------------------------------+</span>


<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        _metadata : dictionary of lists {key, [SummaryEntry]}.  </span>
<span class="sd">        _datatype : dictionary of {key, valuetype} where the keys are the as in _metadata and valuetype is defined in $ADMIT/etc/summary_defs.tab</span>
<span class="sd">        _description : dictionary of {key, description} where the keys are the as in _metadata and description string is defined in $ADMIT/etc/summary_defs.tab</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">=</span> <span class="p">{}</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="p">{}</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_startup</span><span class="p">()</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">SUMMARY</span>

<div class="viewcode-block" id="Summary.getFull"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getFull">[docs]</a>    <span class="k">def</span> <span class="nf">getFull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the full entry [[value(s)], valuetype, description] for </span>
<span class="sd">           the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]]</span>
        <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDescription</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">retval</span></div>

<div class="viewcode-block" id="Summary.get"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the value for the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Summary.getTaskname"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getTaskname">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the task that produced the data </span>
<span class="sd">           for the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           List of zero or more string task names that produced data for the</span>
<span class="sd">           input key.  If no tasks did, the list is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">tasknames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">tasknames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">taskname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tasknames</span></div>
            

<div class="viewcode-block" id="Summary.getAllTaskIDs"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getAllTaskIDs">[docs]</a>    <span class="k">def</span> <span class="nf">getAllTaskIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of all integer task IDs that have written to this Summary</span>
<span class="sd">           for the input key.</span>
<span class="sd">        </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           ----------</span>
<span class="sd">           Sorted list of zero or more integer task ids that produced data for the Summary.  </span>
<span class="sd">           If no tasks ids, the list is empty because you have empty Summary!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">taskids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
           <span class="n">taskids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTaskID</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="c1"># sorted might not be necessary for a set of integers,</span>
        <span class="c1"># but I think there is no guarantee that set is in sort order</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">taskids</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Summary.getTasknameForTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getTasknameForTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">getTasknameForTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the task name matching the input taskid.</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskid : int</span>
<span class="sd">              Task ID to look up</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           String task name or empty string if no match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
               <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">taskid</span> <span class="o">==</span> <span class="n">taskid</span><span class="p">:</span>
                  <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">taskname</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="Summary.getTaskIDsforTaskname"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getTaskIDsforTaskname">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskIDsforTaskname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the task ID(s) matching the input taskname.</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskname : str</span>
<span class="sd">              Task name to look up</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           List of taskids matching the taskname. Empty list if none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">taskids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
               <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">taskname</span> <span class="o">==</span> <span class="n">taskname</span><span class="p">:</span>
                  <span class="n">taskids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">taskid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">taskids</span></div>

<div class="viewcode-block" id="Summary.getTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the integer task ID number that produced the data </span>
<span class="sd">           for the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">           Returns</span>
<span class="sd">           ----------</span>
<span class="sd">           List of zero or more integer taskids that produced data for the</span>
<span class="sd">           input key.  If no tasks did, the list is empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">taskids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="c1"># don&#39;t include unset keys</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">unset</span><span class="p">():</span> <span class="k">continue</span>
            <span class="n">taskids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">taskid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">taskids</span></div>

<div class="viewcode-block" id="Summary.getItemsByTaskname"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getItemsByTaskname">[docs]</a>    <span class="k">def</span> <span class="nf">getItemsByTaskname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all Summary items that were produced </span>
<span class="sd">           by the given task, as dict of SummaryEntrys</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskname : str</span>
<span class="sd">              Task name to look up, case-insensitive</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           Return a dictionary of all SummaryEntrys that were produced </span>
<span class="sd">           by the given task, with keys as in Summary or an empty</span>
<span class="sd">           dictionary if there is no match for the input taskid.</span>

<span class="sd">           Notes</span>
<span class="sd">           -----</span>
<span class="sd">           The values in the returned dictionary may be single SummaryEntry</span>
<span class="sd">           instances or a list of entries; in general, caller code needs to</span>
<span class="sd">           check this explicitly for every key...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tnlower</span> <span class="o">=</span> <span class="n">taskname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
               <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">taskname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">tnlower</span><span class="p">:</span>
                   <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span> 
                       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                           <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                       <span class="k">else</span><span class="p">:</span>
                           <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">]</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="c1"># should this be [p]??</span>
                       <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">return</span> <span class="n">matched</span></div>

<div class="viewcode-block" id="Summary.getItemsByTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getItemsByTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">getItemsByTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all Summary items that were produced </span>
<span class="sd">           by the given taskid, as dict of SummaryEntrys</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskid : int</span>
<span class="sd">              Task ID to look up</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           Return a dictionary of all SummaryEntrys that were produced </span>
<span class="sd">           by the given task, with keys as in Summary or an empty</span>
<span class="sd">           dictionary if there is no match for the input taskid.</span>

<span class="sd">           Notes</span>
<span class="sd">           -----</span>
<span class="sd">           The values in the returned dictionary may be single SummaryEntry</span>
<span class="sd">           instances or a list of entries; in general, caller code needs to</span>
<span class="sd">           check this explicitly for every key...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
               <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">taskid</span> <span class="o">==</span> <span class="n">taskid</span><span class="p">:</span>
                   <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span> 
                       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                           <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                       <span class="k">else</span><span class="p">:</span>
                           <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">p</span><span class="p">]</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">matched</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">return</span> <span class="n">matched</span></div>

<div class="viewcode-block" id="Summary.delItemsByTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.delItemsByTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">delItemsByTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes all summary entries belonging to task #`taskid`.</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskid : int</span>
<span class="sd">              ID of task for which to delete summary information.</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delkeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">taskid</span> <span class="o">!=</span> <span class="n">taskid</span><span class="p">:</span> <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delkeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">delkeys</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="Summary.getDescription"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the description for the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           String description for the key</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span></div>

<div class="viewcode-block" id="Summary.getType"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getType">[docs]</a>    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the value type for the input key. </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           String indicating underlying data type, e.g., &#39;float&#39;, &#39;table&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span></div>

<div class="viewcode-block" id="Summary.set"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the SummaryEntry value for an existing input key</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to set, case insensitive.  Key must already exist.</span>
<span class="sd">           value : SummaryEntry or list of SummaryEntry</span>
<span class="sd">              Entry to set</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checklist</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="c1">#            print &quot;setting &quot; + k + &quot;/&quot; + str(value[0]._taskid) + &quot;/&quot; + str(value) + &quot;/&quot; + str(len(self._metadata[k]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s2">&quot;Key </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="n">k</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">):</span>
<span class="c1">#                print &quot;setting &quot; + k + &quot;/&quot; + str(value._taskid) + &quot;/&quot; + str(value) + &quot;/&quot; + str(len(self._metadata[k]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s2">&quot;Key </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="n">k</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Input value is not an instance of SummaryEntry&quot;</span></div>

<div class="viewcode-block" id="Summary.isTable"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.isTable">[docs]</a>    <span class="k">def</span> <span class="nf">isTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if this key corresponds to an item that is</span>
<span class="sd">            natively an ADMIT table.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to set, case insensitive.  Key must already exist.</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           boolean</span>
<span class="sd">              True if this key corresponds to an item that is</span>
<span class="sd">              natively an ADMIT table, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span></div>

<div class="viewcode-block" id="Summary.insert"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set, replace, or append the SummaryEntry value to the list for an existing input key</span>
<span class="sd">           If the key is not yet set, it will be set with the value.</span>
<span class="sd">           If the key is set, the taskid(s) will be checked and the value will replace</span>
<span class="sd">           the existing value(s) if the keys match.  If the taskids do not match the input</span>
<span class="sd">           value(s) will be appended to the existing value.  </span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to insert, case insensitive.  Key must already exist.</span>
<span class="sd">           value : SummaryEntry or list of SummaryEntry</span>
<span class="sd">              Entry to insert</span>

<span class="sd">           Returns</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># if key is not yet set, just set and return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> 
           <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
           <span class="k">return</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checklist</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># check if a taskid in value matches one in _metadata[key]</span>
            <span class="c1"># replace/extend _metadata[key] appropriately</span>
            <span class="c1"># This is done by creating a set of the current</span>
            <span class="c1"># entries for the key, then comparing them with</span>
            <span class="c1"># the input list.  The comparison is done soley</span>
            <span class="c1"># based on the taskid.   SummaryEntry has comparators</span>
            <span class="c1"># __eq__ and __hash__() to facilitate this. </span>
            <span class="c1"># This works because design, a single task can only write one</span>
            <span class="c1"># entry to a given key.</span>
            <span class="n">currentset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">currentset</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">currentset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">currentset</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s2">&quot;Key </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="n">k</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">):</span>
                <span class="n">currentset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="n">currentset</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">currentset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">currentset</span><span class="p">)</span>
                
               <span class="c1"># for i in range(len(self._metadata[k])):</span>
               <span class="c1">#      if self._metadata[k][i]._taskid == value._taskid:</span>
<span class="c1">#              #           print &quot;replacing &quot; + k + &quot;/&quot; + str(value._taskid) + &quot;/&quot; + str(value) + &quot;/&quot; + str(len(self._metadata[k]))</span>
               <span class="c1">#          self._metadata[k][i] = value</span>
               <span class="c1">#          return</span>
<span class="c1">#              #  print &quot;appending &quot; + k + &quot;/&quot; + str(value._taskid) + &quot;/&quot; + str(value) + &quot;/&quot; + str(len(self._metadata[k]))</span>
               <span class="c1"># self._metadata[k].append(value)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Input value does not contain instance of SummaryEntry&quot;</span></div>
            
<div class="viewcode-block" id="Summary.show"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showunset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the all entries [key, values, description].</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">            showunset : boolean</span>
<span class="sd">              If True, show unset values in addition to set values. Default: False</span>

<span class="sd">           Returns</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showunset</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;key = </span><span class="si">%s</span><span class="s2"> entry = [</span><span class="si">%s</span><span class="s2">] desc=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescription</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>
                <span class="c1">#print &quot;key = %s entry = [%s] LEN=%d&quot; % (key, v, len(self._metadata[key]) )</span>

<div class="viewcode-block" id="Summary.unset"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.unset">[docs]</a>    <span class="k">def</span> <span class="nf">unset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
       <span class="sd">&quot;&quot;&quot;Determine if the key has any data.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key : str</span>
<span class="sd">              Key to retrieve, case insensitive.</span>

<span class="sd">           Returns </span>
<span class="sd">           -------</span>
<span class="sd">           boolean</span>
<span class="sd">               True if the value for the key has not been set, False otherwise.</span>
<span class="sd">       &quot;&quot;&quot;</span>
       <span class="c1"># if the value is the startup value, then the key is not set.</span>
       <span class="c1"># If the first entry is unset, assume there are not additional entries</span>
       <span class="c1"># that might not be unset!</span>
       <span class="c1">#if self.get(key)[0].unset():</span>
       <span class="c1">#    print &quot;####UNSET() key = %s val=%s&quot; % (key, str(self.get(key)[0]))</span>
       <span class="c1">#    return True</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unset</span><span class="p">()</span></div>

<div class="viewcode-block" id="Summary.getLineTable"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getLineTable">[docs]</a>    <span class="k">def</span> <span class="nf">getLineTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the table of spectral lines found</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           --------</span>
<span class="sd">           An admit.Table with spectral line entries or empty Table if</span>
<span class="sd">           no lines were found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">):</span> 
            <span class="k">return</span> <span class="n">atable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SummaryEntry data for linelist are</span>
            <span class="c1"># a line list admit.Table of form</span>
            <span class="c1"># [frequency1, name1, ...]</span>
            <span class="c1"># [frequency1, name2, ...]</span>
            <span class="n">summaryentry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summaryentry</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">atable</span></div>

<div class="viewcode-block" id="Summary.getLinelist"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getLinelist">[docs]</a>    <span class="k">def</span> <span class="nf">getLinelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of spectral lines found</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           --------</span>
<span class="sd">           A Python list with spectral line entries or empty list if</span>
<span class="sd">           no lines were found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLineTable</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Summary.getLinenames"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getLinenames">[docs]</a>    <span class="k">def</span> <span class="nf">getLinenames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the names of spectral lines found</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           --------</span>
<span class="sd">           A list of string spectral line names or empty list if</span>
<span class="sd">           no lines were found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unset</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">):</span> 
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SummaryEntry data for linelist are</span>
            <span class="c1"># a line list table of form</span>
            <span class="c1"># [</span>
            <span class="c1"># [frequency1, name1, ...]</span>
            <span class="c1"># [frequency1, name2, ...]</span>
            <span class="c1"># ]</span>
            <span class="c1"># want the slice through &quot;name&quot;</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLinelist</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">names</span></div>

<div class="viewcode-block" id="Summary.getLinefluxes"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.getLinefluxes">[docs]</a>    <span class="k">def</span> <span class="nf">getLinefluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an estimate of the line fluxes from the line list</span>
<span class="sd">           by multiplying Peak * Linewidth.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           --------</span>
<span class="sd">           A dictionary of &#39;image filename&#39;:flux for all non-blended spectral lines in the line list,</span>
<span class="sd">           or an empty dictionary if no line list is available or linecubes were not created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLineTable</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># note test order matters as len(None) is an error.</span>
        <span class="k">if</span> <span class="n">linelist</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">linelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
           <span class="k">return</span> <span class="p">{}</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">peak</span> <span class="o">=</span> <span class="n">linelist</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;peakintensity&quot;</span><span class="p">)</span>
        <span class="n">fwhm</span> <span class="o">=</span> <span class="n">linelist</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;fwhm&quot;</span><span class="p">)</span>
        <span class="n">startchan</span> <span class="o">=</span> <span class="n">linelist</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;startchan&quot;</span><span class="p">)</span>
        <span class="n">endchan</span> <span class="o">=</span> <span class="n">linelist</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;endchan&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linelist</span><span class="p">)):</span>
          <span class="c1"># Magic numbers! If these startchan and endchan</span>
          <span class="c1"># then the line is blended and a separate line cube</span>
          <span class="c1"># was not created!</span>
          <span class="c1"># Compare as strings because numpy converts all list members to </span>
          <span class="c1"># strings if any member is a string.</span>
          <span class="k">if</span> <span class="n">startchan</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">endchan</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
             <span class="k">continue</span>
          <span class="c1"># peak == l[9], fwhm == l[11]</span>
          <span class="n">fluxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">fwhm</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
 
        <span class="c1"># assume only one SummaryEntry, what happens if we have run linecube</span>
        <span class="c1"># multiple times??</span>
        <span class="n">linecube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linecube&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">linecube</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
           <span class="c1"># a line list was made but no linecubes, so we can&#39;t get filenames</span>
           <span class="k">return</span> <span class="p">{}</span>
        <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
        <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">linecube</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#[[basefile1,startchan1,endchan1,outfile2],...[basefileN,startchanN,endchanN,outfileN]]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;Output Cube&quot;</span><span class="p">)</span>
        <span class="n">flux_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">fluxes</span><span class="p">):</span>
           <span class="n">flux_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
 
        <span class="k">return</span> <span class="n">flux_dict</span></div>

<div class="viewcode-block" id="Summary.write"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to write out the summary data to XML</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            root : cElementTree node to attach to</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">snode</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;summaryData&quot;</span><span class="p">)</span>
        <span class="n">snode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="n">bt</span><span class="o">.</span><span class="n">SUMMARY</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">mnode</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">snode</span><span class="p">,</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
            <span class="n">mnode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="n">bt</span><span class="o">.</span><span class="n">METADATA</span><span class="p">)</span>
            <span class="n">mnode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mnode</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">XmlWriter</span><span class="o">.</span><span class="n">XmlWriter</span><span class="p">(</span><span class="bp">self</span><span class="p">,[</span><span class="s2">&quot;_datatype&quot;</span><span class="p">,</span><span class="s2">&quot;_description&quot;</span><span class="p">],{</span><span class="s2">&quot;_datatype&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">DICT</span><span class="p">,</span><span class="s2">&quot;_description&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">DICT</span><span class="p">},</span><span class="n">snode</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span></div>

    <span class="c1"># not terribly useful since columns aren&#39;t labelled.</span>
    <span class="c1">#def _linelistToJSON(self,outdir):</span>
    <span class="c1">#    &quot;&quot;&quot;Write the linelist to a JSON formatted file, so the</span>
    <span class="c1">#       lineID editor can read it.</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    #@todo what if there is more than one linelist?</span>
    <span class="c1">#    outfile = outdir + &quot;ll.json&quot;</span>
    <span class="c1">#    f = open(outfile,&quot;w&quot;)</span>
    <span class="c1">#    linelist = self.getLinelist()</span>
    <span class="c1">#    json.dump(linelist,f)</span>
    <span class="c1">#    f.close()</span>

    <span class="k">def</span> <span class="nf">_linetableToJSON</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the linelist table to a JSON formatted file, so the</span>
<span class="sd">           lineID editor can read it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># a.run() can be called anytime in a script. don&#39;t</span>
        <span class="c1"># attempt write out lineid editor data if LineID_AT has not been called</span>
        <span class="n">linelists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">)</span>

        <span class="c1"># naxis3 is stored as numpy.int32, which is not json serializable</span>
        <span class="c1"># so convert to python int.</span>
        <span class="c1"># Q: Should this be done at storage time or a read time?</span>
        <span class="c1"># @TODO CubeSpectrum, GenerateSpectrum, PVSlice should write this </span>
        <span class="c1"># to summary? </span>
        <span class="n">n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;naxis3&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n3</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unset</span><span class="p">():</span>
            <span class="n">naxis3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">naxis3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#debug</span>
        <span class="c1">#f.write(self.getLineTable()._jsondict())</span>
        <span class="n">numlists</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linelists</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numlists</span><span class="p">):</span>
            <span class="n">summaryentry</span> <span class="o">=</span> <span class="n">linelists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">unset</span><span class="p">():</span>
               <span class="k">continue</span><span class="p">;</span>
            <span class="n">tid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskID</span><span class="p">())</span>
            <span class="n">outbase</span> <span class="o">=</span> <span class="s2">&quot;lltable.&quot;</span><span class="o">+</span><span class="n">tid</span><span class="o">+</span><span class="s2">&quot;.json&quot;</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="n">outbase</span>
            <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outbase</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

            <span class="n">tabstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLineTable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">_jsondict</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;{&quot;taskid&quot;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskID</span><span class="p">())</span> <span class="o">+</span><span class="s1">&#39;, &quot;naxis3&quot;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">naxis3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tabstr</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">tabstr</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}&#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tabstr</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="c1">#f.close()</span>
        <span class="c1">#outfile = outdir + &quot;lltask.json&quot;</span>
        <span class="c1">#x = {&quot;taskid&quot;: summaryentry.getTaskID(), &quot;naxis3&quot; : naxis3}</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;llfiles.json&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">filelist</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_writeuuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write out a uuid to with the data.  This is an attempt</span>
<span class="sd">           to allow caching of data in browser between page revisits.</span>
<span class="sd">           Since our form-based pages are fetched with POST, they are not </span>
<span class="sd">           cached by normal browser mechanism.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s2">&quot;uuid.json&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uid</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>  
           <span class="n">uid</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uid</span><span class="p">}</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Summary.html"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">flowmanager</span><span class="p">,</span><span class="n">dotdiagram</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">editor</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">admitloc</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">admit_root</span><span class="p">()</span>
        <span class="n">admitetc</span> <span class="o">=</span> <span class="n">admitloc</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;etc&quot;</span>
        <span class="n">admit_headfile</span> <span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;index_head.html&quot;</span>
        <span class="n">admit_flowfile</span> <span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;flowdiagram.html&quot;</span>
        <span class="n">admit_flowdiagram</span> <span class="o">=</span> <span class="n">dotdiagram</span>
        <span class="n">admit_tailfile</span> <span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;index_tail.html&quot;</span>
        <span class="n">admit_lineIDedithead</span><span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;lineIDedit_head.html&quot;</span>
        <span class="n">admit_lineIDeditfile</span> <span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;lineIDedit_template.html&quot;</span>
        <span class="c1"># outdir has trailing slash, need to strip it or</span>
        <span class="c1"># basename() returns &#39;&#39;</span>
        <span class="c1"># python basename() behavior different from Unix!!</span>
        <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">outdir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>

        <span class="c1"># Spit out the boiler plate that is the same for</span>
        <span class="c1"># all index.html files.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_headfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">basedir</span><span class="p">,</span><span class="n">basedir</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">outdir</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="p">):</span>
           <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;index.html&quot;</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s2">&quot;index.html&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

        <span class="c1"># If a flow diagram was created, write out the</span>
        <span class="c1"># HTML to display it.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">admit_flowdiagram</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_flowfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="n">basedir</span><span class="p">)</span>

        <span class="c1"># Now process each task summary output in ID (flow) order</span>
        <span class="c1">#------------------------------------------------------------------</span>
        <span class="c1"># this is no longer workable because it won&#39;t include failed tasks</span>
        <span class="c1"># so use the flowmanager list instead</span>
        <span class="c1">#taskids = self.getAllTaskIDs()  </span>
        <span class="c1">#------------------------------------------------------------------</span>
        <span class="n">taskids</span> <span class="o">=</span> <span class="n">flowmanager</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">taskids</span><span class="p">:</span>
            <span class="c1">#tname = self.getTasknameForTaskID(tid) # see above</span>
            <span class="n">tname</span> <span class="o">=</span> <span class="n">flowmanager</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
            <span class="n">titems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getItemsByTaskID</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">titems</span><span class="p">,</span><span class="n">flowmanager</span><span class="p">[</span><span class="n">tid</span><span class="p">],</span> <span class="n">outdir</span><span class="p">))</span>

        <span class="c1"># finally, spit out the standard file ending HTML.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_tailfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span> 
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_linetableToJSON</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
        <span class="c1">#self._writeuuid(outdir,uid)</span>

        <span class="k">if</span> <span class="n">editor</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_lineIDedithead</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">basedir</span><span class="p">,</span><span class="n">basedir</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">outdir</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="p">):</span>
               <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;lineIDedit.html&quot;</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="s2">&quot;lineIDedit.html&quot;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

            <span class="c1"># now process data needed for lineID editor file.</span>
            <span class="c1"># since we have defined __cmp__ this will sort by taskid</span>
            <span class="n">linelists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">))</span>
            <span class="n">numlists</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linelists</span><span class="p">)</span>

            <span class="c1">#===============================================================</span>
            <span class="c1"># ugh, don&#39;t like that this is cut&#39;n&#39;paste from _process.</span>
            <span class="k">if</span> <span class="n">linelists</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">numlists</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> 
                <span class="n">llstr</span><span class="o">=</span><span class="s2">&quot;&lt;br&gt;&lt;h4&gt;LineID_AT identified no spectral lines in the input cube(s)&lt;/h4&gt;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numlists</span><span class="p">):</span>
                    <span class="n">llstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">summaryentry</span> <span class="o">=</span> <span class="n">linelists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">unset</span><span class="p">():</span>
                       <span class="k">continue</span><span class="p">;</span>
                    <span class="n">tid</span> <span class="o">=</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskID</span><span class="p">()</span>
                    <span class="n">taskargs</span> <span class="o">=</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskArgs</span><span class="p">()</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;!-- #################### BEGIN LINEID_AT </span><span class="si">%d</span><span class="s2"> #################### --&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tid</span><span class="p">)</span>

                    <span class="n">atable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLineTable</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                           <span class="n">llstr</span><span class="o">=</span><span class="s2">&quot;&lt;br&gt;&lt;h4&gt;LineID_AT identified no spectral lines in this cube&lt;/h4&gt;&quot;</span>

                    <span class="c1"># Even if no lines are identified, spectra still written out.</span>
                    <span class="n">tname</span> <span class="o">=</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskname</span><span class="p">();</span>
                    <span class="n">thetask</span> <span class="o">=</span> <span class="n">flowmanager</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span>
                    <span class="c1"># crashed, stale and disabled tasks will have a different color bars.</span>
                    <span class="c1"># If a task reports it is running outside of task.execute(), then it must have crashd.</span>
                    <span class="k">if</span> <span class="n">thetask</span><span class="o">.</span><span class="n">running</span><span class="p">():</span>  
                      <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;crashed-admittask&quot;</span> 
                    <span class="k">elif</span> <span class="n">thetask</span><span class="o">.</span><span class="n">enabled</span><span class="p">():</span>
                      <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;stale-admittask&quot;</span> <span class="k">if</span> <span class="n">thetask</span><span class="o">.</span><span class="n">isstale</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;label-admittask&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                      <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;disabled-admittask&quot;</span> 
                    <span class="n">titems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getItemsByTaskID</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
                    <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
                    <span class="c1">#print &quot;SPECTRA %s&quot; % spectra</span>
                    <span class="k">if</span> <span class="n">spectra</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                       <span class="n">MAX_THUMBNAILS_PER_ROW</span> <span class="o">=</span> <span class="mi">3</span>  
                       <span class="n">SPANSVGVAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">.html&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
                       <span class="n">SPAN4VAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;fancybox&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;!--caption--&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
                       <span class="c1"># SPAN4VAL with 2 added buttons</span>
                       <span class="c1"># Note because of the path problem, we currently hide the</span>
                       <span class="c1"># Export To Fits button with &lt;span style=&quot;display:none&quot;&gt;</span>
                       <span class="n">SPAN4VALB</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;fancybox&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;!--caption--&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> &lt;span style=&quot;display:none&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/span&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
                       <span class="n">SPANXVAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;!-- spanx --&gt;&#39;</span>
                       <span class="n">ENDROW</span> <span class="o">=</span> <span class="s1">&#39;&lt;/div&gt;&lt;!-- row-fluid --&gt; </span><span class="se">\n</span><span class="s1">&#39;</span>
                       <span class="n">STARTROW</span> <span class="o">=</span><span class="s1">&#39;&lt;div class=&quot;row-fluid&quot;&gt;&#39;</span>
                       <span class="n">allspecs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                       <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

                       <span class="c1"># @todo this is a godforsaken kludge because running multiple lineIDs creates</span>
                       <span class="c1"># multiple spectra so that titems[&quot;spectra&quot;] = [SummaryEntry,SummaryEntry,...]</span>
                       <span class="c1"># rather than SummaryEntry.  This is a problem with getItemsByTaskName--previously </span>
                       <span class="c1"># each run inserts another level of [].  I have patched it, but I think it is still not</span>
                       <span class="c1"># correct.</span>
                       <span class="c1"># Why hasn&#39;t this failed when there are spectra by both CubeSpect_AT and LineID_AT, which</span>
                       <span class="c1"># uses getItemsByTaskID which has similar code matched[k] = [matched[k],p]</span>
                       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                          <span class="n">mylist</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                       <span class="k">else</span><span class="p">:</span>
                          <span class="n">mylist</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">value</span>
                       
                       <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
                           <span class="c1">#print &quot;type(val) = %s&quot; % type(val)</span>
                           <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                              <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                           <span class="k">else</span><span class="p">:</span> 
                              <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                           
                           <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                           <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                           <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                           <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                           <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                           <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                           <span class="n">top</span>   <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

                           <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imageIsSVG</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
                               <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPANSVGVAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">makesvghtml</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">caption</span><span class="p">,</span><span class="n">outdir</span><span class="p">)</span>
                           <span class="k">else</span><span class="p">:</span>
                               <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                           <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                           <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="n">llstr</span> <span class="o">=</span> <span class="n">llstr</span> <span class="o">+</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="n">ENDROW</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_lineIDeditfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                        <span class="c1">#                        %s     %d      %s                 %s    %d     %s                      %d   %d   %d   %s    %d   %d  %d  %d  %d  %d  %d  %d  %d  %d  %d %d</span>
                        <span class="n">header</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span> <span class="n">tname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span> <span class="n">summaryentry</span><span class="o">.</span><span class="n">getTaskArgs</span><span class="p">(),</span><span class="n">tid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span> <span class="n">llstr</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;!-- #################### END LINEID_AT </span><span class="si">%d</span><span class="s2"> #################### --&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tid</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_tailfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">tail</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_imageIsSVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">image</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;svg&#39;</span><span class="p">:</span> 
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Summary.makesvghtml"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.Summary.makesvghtml">[docs]</a>    <span class="k">def</span> <span class="nf">makesvghtml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">caption</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>

        <span class="c1"># filter out non-svg images</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imageIsSVG</span><span class="p">(</span><span class="n">image</span><span class="p">):</span> <span class="k">return</span>

        <span class="n">admitloc</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">admit_root</span><span class="p">()</span>
        <span class="n">admitetc</span> <span class="o">=</span> <span class="n">admitloc</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;etc&quot;</span>
        <span class="n">admit_svgfile</span> <span class="o">=</span> <span class="n">admitetc</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s2">&quot;svg_template.html&quot;</span>
        <span class="c1"># outdir has trailing slash, need to strip it or</span>
        <span class="c1"># basename() returns &#39;&#39;</span>
        <span class="c1"># python basename() behavior different from Unix!!</span>
        <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">outdir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admit_svgfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="n">basedir</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">caption</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">outdir</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="p">):</span>
           <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">image</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">+</span> <span class="n">image</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">titems</span><span class="p">,</span><span class="n">thetask</span><span class="p">,</span><span class="n">outdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the SummaryEntrys for individual tasks and return formatted HTML to represent the summary data&quot;&quot;&quot;</span>

        <span class="c1"># ------ constants used in this method --------</span>
        <span class="c1"># Because there are 12 slots per row in Bootstrap CSS, and</span>
        <span class="c1"># we are using 4 slots (&quot;span4&quot;) per thumbnail, then max thumbnails per row is 3.</span>
        <span class="n">MAX_THUMBNAILS_PER_ROW</span> <span class="o">=</span> <span class="mi">3</span>  
        <span class="n">SPANSVGVAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">.html&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
        <span class="n">SPAN4VAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;fancybox&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
        <span class="c1"># Export To Fits button with &lt;span style=&quot;display:none&quot;&gt;</span>
        <span class="c1"># Note because of the path problem, we currently hide the</span>
        <span class="n">SPAN4VALB</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span4&quot;&gt;&lt;div class=&quot;thumbnail&quot;&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot; class=&quot;fancybox&quot;&gt;&lt;img src=&quot;</span><span class="si">%s</span><span class="s1">&quot; alt=&quot;</span><span class="si">%s</span><span class="s1">&quot; title=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&lt;/a&gt;&lt;div class=&quot;caption&quot;&gt;&lt;h5&gt;</span><span class="si">%s</span><span class="s1">&lt;/h5&gt;&lt;/div&gt;&lt;!--caption--&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> &lt;span style=&quot;display:none&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/span&gt;&lt;/div&gt;&lt;!-- thumbnail --&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;&lt;!-- span4 --&gt;&#39;</span>
        <span class="n">SPANXVAL</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;span</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;!-- spanx --&gt;&#39;</span>
        <span class="n">ENDROW</span> <span class="o">=</span> <span class="s1">&#39;&lt;/div&gt;&lt;!-- row-fluid --&gt; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">STARTROW</span> <span class="o">=</span><span class="s1">&#39;&lt;div class=&quot;row-fluid&quot;&gt;&#39;</span>
        <span class="c1">#----------------------------------------------------</span>
        <span class="n">tlower</span> <span class="o">=</span> <span class="n">taskname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">tupper</span> <span class="o">=</span> <span class="n">taskname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">admitloc</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">admit_root</span><span class="p">()</span>
        <span class="n">admitetc</span> <span class="o">=</span> <span class="n">admitloc</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;etc&quot;</span>
        <span class="n">admitfile</span> <span class="o">=</span> <span class="n">admitetc</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">tlower</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
        <span class="n">admitfail</span><span class="o">=</span> <span class="n">admitetc</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;failed_at.html&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admitfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">header</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">admitfail</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">failedheader</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;!-- ***** failed to open </span><span class="si">%s</span><span class="s2"> ***** --&gt;&quot;</span> <span class="o">%</span> <span class="n">admitfile</span>

        <span class="n">topval</span> <span class="o">=</span> <span class="s2">&quot;&lt;!-- ############### BEGIN </span><span class="si">%s</span><span class="s2"> ###############--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tupper</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s2">: TBD by if tlower==</span><span class="si">%s</span><span class="s2"> below!&lt;/b&gt;&lt;br&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tupper</span><span class="p">,</span><span class="n">tlower</span><span class="p">)</span>    <span class="c1"># see below</span>
        <span class="n">botval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;!-- ############### END </span><span class="si">%s</span><span class="s2"> ###############--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tupper</span>

        <span class="c1"># crashed, stale and disabled tasks will have a different color bars.</span>
        <span class="c1"># If a task reports it is running outside of task.execute(), then it must have crashd.</span>
        <span class="n">taskargs</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">thetask</span><span class="o">.</span><span class="n">running</span><span class="p">():</span>  
          <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;crashed-admittask&quot;</span> 
          <span class="n">retval</span> <span class="o">=</span> <span class="n">failedheader</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">topval</span> <span class="o">+</span> <span class="n">retval</span> <span class="o">+</span> <span class="n">botval</span>
        <span class="k">elif</span> <span class="n">thetask</span><span class="o">.</span><span class="n">enabled</span><span class="p">():</span>
          <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;stale-admittask&quot;</span> <span class="k">if</span> <span class="n">thetask</span><span class="o">.</span><span class="n">isstale</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;label-admittask&quot;</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">taskclass</span> <span class="o">=</span> <span class="s2">&quot;disabled-admittask&quot;</span> 

        <span class="c1"># If the task before this one crashed, then this one will have no summary data.</span>
        <span class="c1"># So just return.   Ideally, we might want each task to write a little bit of summary</span>
        <span class="c1"># data when it starts, rather than all at the end.  But for now, short-circuit.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">titems</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">topval</span> <span class="o">+</span> <span class="n">botval</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;ingest_at&quot;</span><span class="p">:</span>
            <span class="n">fitsfile</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;fitsname&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
                <span class="n">fitsfile</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;fitsname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">taskargs</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;fitsname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">taskargs</span>
            <span class="n">casaimage</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;casaname&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
                <span class="n">casaimage</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;casaname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">taskargs</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;casaname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">taskargs</span>
            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;object&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">beam</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;bmaj&#39;</span> <span class="ow">in</span> <span class="n">titems</span> <span class="ow">and</span> <span class="s1">&#39;bmin&#39;</span> <span class="ow">in</span> <span class="n">titems</span> <span class="ow">and</span> <span class="s1">&#39;bpa&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">bmaj</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;bmaj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
               <span class="n">bmin</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
               <span class="n">bpa</span>  <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;bpa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">beam</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%5.2f</span><span class="se">\&quot;</span><span class="s2"> x </span><span class="si">%5.2f</span><span class="se">\&quot;</span><span class="s2"> PA @ </span><span class="si">%5.2f</span><span class="s2"> deg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bmaj</span><span class="p">,</span><span class="n">bmin</span><span class="p">,</span><span class="n">bpa</span><span class="p">)</span>
            <span class="n">nx1</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">nx2</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;naxis1&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
                <span class="n">nx1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;naxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;naxis2&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
                <span class="n">nx2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;naxis2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nx3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;naxis3&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">nx3</span> <span class="o">=</span> <span class="s2">&quot; x &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;naxis3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">imsize</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> x </span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nx1</span><span class="p">,</span><span class="n">nx2</span><span class="p">,</span><span class="n">nx3</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">bunit</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">telescope</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">badpixel</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">restfreq</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="n">vlsr</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;datamin&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">dmin</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3E</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;datamin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;datamax&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">dmax</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3E</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;datamax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;bunit&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">bunit</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;bunit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;telescop&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">telescope</span> <span class="o">=</span> <span class="n">titems</span><span class="p">[</span><span class="s1">&#39;telescop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;badpixel&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">badpixel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;badpixel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;restfreq&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">restfreq</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%4.6f</span><span class="s2"> GHz&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;restfreq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1</span><span class="n">E9</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;vlsr&#39;</span> <span class="ow">in</span> <span class="n">titems</span><span class="p">:</span>
               <span class="n">vlsr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2"> km/s (estimated)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">titems</span><span class="p">[</span><span class="s1">&#39;vlsr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">fitsfile</span><span class="p">,</span><span class="n">fitsfile</span><span class="p">,</span><span class="n">casaimage</span><span class="p">,</span><span class="n">casaimage</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">restfreq</span><span class="p">,</span><span class="n">vlsr</span><span class="p">,</span><span class="n">beam</span><span class="p">,</span><span class="n">imsize</span><span class="p">,</span><span class="n">bunit</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">,</span><span class="n">telescope</span><span class="p">,</span><span class="n">badpixel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;cubespectrum_at&quot;</span><span class="p">:</span>
           <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="c1"># task arguments are the same in all entries.</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spectra</span><span class="o">.</span><span class="n">getValue</span><span class="p">():</span>
                   <span class="c1"># default bootstrap width is 12 columns. We are using &#39;span4&#39; so</span>
                   <span class="c1"># thumbnail &#39;cell&#39; is 4 columns. Therefore, if we have more than </span>
                   <span class="c1"># 3 thumbnails, start a new row.</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                   <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                   <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                   <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

               <span class="n">banner</span> <span class="o">=</span> <span class="s1">&#39;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s1"> output for image </span><span class="si">%s</span><span class="s1">&lt;/h4&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">casaimage</span><span class="p">)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output for image </span><span class="si">%s</span><span class="s2"> &lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">casaimage</span><span class="p">)</span>

           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;regrid_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span><span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;regrid&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
               <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
               <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">bigstr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> did nothing for the input image(s)&lt;/h4&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span>
                   <span class="n">bigstr</span> <span class="o">=</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">ENDROW</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">bigstr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> wrote no summary output&lt;/h4&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">bigstr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
         
        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;cubesum_at&quot;</span><span class="p">:</span>
           <span class="n">cubesum</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cubesum&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">cubesum</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">cubesum</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">cubesum</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
               <span class="n">auximage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
               <span class="n">auxthumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
               <span class="n">auxcaption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
               <span class="n">outcasaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
               <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
               <span class="n">button</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">outcasaimage</span><span class="p">,</span><span class="s2">&quot;viewimage&quot;</span><span class="p">,</span><span class="s2">&quot;View in CASA&quot;</span><span class="p">)</span>
               <span class="c1"># can&#39;t have two buttons with same html ID, so add &quot;.fits&quot;</span>
               <span class="n">button2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">outcasaimage</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">,</span><span class="s2">&quot;exportimage&quot;</span><span class="p">,</span><span class="s2">&quot;Export to FITS&quot;</span><span class="p">)</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">SPAN4VALB</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span><span class="n">button</span><span class="p">,</span><span class="n">button2</span><span class="p">)</span>
               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> output for </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">casaimage</span><span class="p">)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> computed nothing for the input image&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;continuumsub_at&quot;</span><span class="p">:</span>
           <span class="n">continuumsub</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;continuumsub&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">continuumsub</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">continuumsub</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">continuumsub</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
               <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                   <span class="n">auximage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">auxthumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">auxcaption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">)</span>
               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> output for </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="s2">&quot;casaimage&quot;</span><span class="p">)</span>
               <span class="c1">#banner = &quot;&lt;br&gt;&lt;h4&gt;%s output for %s&lt;/h4&gt;&quot; % (taskname, casaimage)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> no continuum subtracted for the input image&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
               
        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;cubestats_at&quot;</span><span class="p">:</span>
           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rmsmethd&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
              <span class="n">rmsmethod</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span> 
              <span class="n">casaimage</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
              <span class="n">taskargs</span>  <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
           <span class="k">else</span><span class="p">:</span>
              <span class="n">rmsmethod</span> <span class="o">=</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">casaimage</span> <span class="o">=</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
              <span class="n">taskargs</span> <span class="o">=</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">taskargs</span>

           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chanrms&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
              <span class="n">chanrms</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>    
           <span class="k">else</span><span class="p">:</span>
              <span class="n">chanrms</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3E</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dynrange&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
              <span class="n">dynrange</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>    
           <span class="k">else</span><span class="p">:</span>
              <span class="n">dynrange</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3E</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;datamean&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
              <span class="n">datamean</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>    
           <span class="k">else</span><span class="p">:</span>
              <span class="n">datamean</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3E</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="c1">#@todo do something with position and box?</span>
               <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
               <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
               <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
               <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
               <span class="n">thumb</span>   <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
               <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>

           <span class="n">sumentry</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;peakpnt&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">sumentry</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">sumentry</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="n">image</span>   <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">thumb</span>   <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
            
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">casaimage</span><span class="p">,</span><span class="n">casaimage</span><span class="p">,</span><span class="n">rmsmethod</span><span class="p">,</span><span class="n">chanrms</span><span class="p">,</span><span class="n">dynrange</span><span class="p">,</span><span class="n">datamean</span><span class="p">,</span><span class="n">specval</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;lineid_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linelist&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no spectral lines in this cube&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
               <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no spectral lines in this cube&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span>

           <span class="c1"># output the static table that will be show if user is</span>
           <span class="c1"># viewing with file:// protocol.  If using http:// protocol,</span>
           <span class="c1"># then the live table will be shown. See etc/lineid_at.html</span>
           <span class="n">bigstr</span> <span class="o">=</span> <span class="s1">&#39;&lt;br&gt;&lt;div class=&quot;row-fluid staticdisplay&quot;&gt;&#39;</span> <span class="o">+</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">ENDROW</span>
           <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">spectra</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">bigstr</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spectra</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                   <span class="c1"># default bootstrap width is 12 columns. We are using &#39;span4&#39; so</span>
                   <span class="c1"># thumbnail &#39;cell&#39; is 4 columns. Therefore, if we have more than </span>
                   <span class="c1"># 3 thumbnails, start a new row.</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                   <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                   <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                   <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                   
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imageIsSVG</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
                       <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPANSVGVAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">makesvghtml</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">caption</span><span class="p">,</span><span class="n">outdir</span><span class="p">)</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
               <span class="n">bigstr</span> <span class="o">=</span> <span class="n">bigstr</span> <span class="o">+</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="n">ENDROW</span>
               <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">bigstr</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;moment_at&quot;</span><span class="p">:</span>
           <span class="n">moments</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;moments&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
           <span class="k">if</span> <span class="n">moments</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="n">auximage</span> <span class="o">=</span> <span class="p">[]</span>
               <span class="n">auxthumb</span>  <span class="o">=</span> <span class="p">[]</span>
               <span class="n">auxcaption</span> <span class="o">=</span> <span class="p">[]</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">moments</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">moments</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">ENDROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">linename</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                   <span class="n">mom</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                   <span class="n">image</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                   <span class="n">thumb</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">caption</span>  <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">auximage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                   <span class="n">auxthumb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                   <span class="n">auxcaption</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                   <span class="n">casamoment</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># remove &#39;.png&#39; to get name of moment CASA format image</span>
                   <span class="n">button</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">casamoment</span><span class="p">,</span><span class="s2">&quot;viewimage&quot;</span><span class="p">,</span><span class="s2">&quot;View in CASA&quot;</span><span class="p">)</span>
                   <span class="c1"># can&#39;t have two buttons with same html ID, so add &quot;.fits&quot;</span>
                   <span class="n">button2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">casamoment</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">,</span><span class="s2">&quot;exportimage&quot;</span><span class="p">,</span><span class="s2">&quot;Export to FITS&quot;</span><span class="p">)</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VALB</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span><span class="n">button2</span><span class="p">))</span>
                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> output for </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">casaimage</span><span class="p">)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span>
           <span class="k">else</span><span class="p">:</span> 
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No moments were computed for this cube&lt;/h4&gt;&quot;</span>

           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;pvslice_at&quot;</span><span class="p">:</span>
           <span class="n">pvslices</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pvslices&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">pvslices</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pvslices</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">STARTROW</span>
                   <span class="n">slicetype</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                   <span class="n">sliceargs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                   <span class="n">image</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                   <span class="n">thumb</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">caption</span>  <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                       <span class="n">overlayimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                       <span class="n">overlaythumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                       <span class="n">overlaycaption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                       <span class="n">pvname</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> 
                       <span class="n">slicename</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> 
                       <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">overlayimage</span><span class="p">,</span> <span class="n">overlaythumb</span><span class="p">,</span> <span class="n">overlaycaption</span><span class="p">,</span> <span class="n">overlaycaption</span><span class="p">,</span> <span class="n">overlaycaption</span><span class="p">))</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">pvname</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> 
                       <span class="n">slicename</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> 
                   <span class="n">button</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">pvname</span><span class="p">,</span><span class="s2">&quot;viewimage&quot;</span><span class="p">,</span><span class="s2">&quot;View in CASA&quot;</span><span class="p">)</span>
                   <span class="c1"># can&#39;t have two buttons with same html ID, so add &quot;.fits&quot;</span>
                   <span class="n">button2</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">pvname</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">,</span><span class="s2">&quot;exportimage&quot;</span><span class="p">,</span><span class="s2">&quot;Export to FITS&quot;</span><span class="p">)</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VALB</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span><span class="n">button</span><span class="p">,</span><span class="n">button2</span><span class="p">))</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="n">ENDROW</span>

               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> output for </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">slicename</span><span class="p">)</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">specval</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No PV slices were computed for this cube&lt;/h4&gt;&quot;</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">pvslices</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">specval</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;linecube_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linecube&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> created the following cubes&lt;/h4&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No Line Cubes were computed from the input cube&lt;/h4&gt;&quot;</span>
               <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
               <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No Line Cubes were computed from the input cube&lt;/h4&gt;&quot;</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="c1"># create a column of &quot;View in CASA&quot; buttons and add to table</span>
                   <span class="n">imnames</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">getColumnByName</span><span class="p">(</span><span class="s2">&quot;Output Cube&quot;</span><span class="p">)</span>
                   <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>
                   <span class="n">buttons2</span> <span class="o">=</span> <span class="p">[]</span>
                   <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">imnames</span><span class="p">:</span>
                       <span class="n">buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;viewimage&quot;</span><span class="p">,</span><span class="s2">&quot;View in CASA&quot;</span><span class="p">))</span>
                       <span class="n">buttons2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">getButton</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">,</span><span class="s2">&quot;exportimage&quot;</span><span class="p">,</span><span class="s2">&quot;Export to FITS&quot;</span><span class="p">))</span>
                   <span class="n">atable</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
                   <span class="c1"># disable for now : atable.addColumn(buttons2)</span>
                   <span class="c1"># PJT  caused LineCube to fail?</span>
                   <span class="c1">#atable.columns[len(atable)-1] = &quot;&quot;</span>
                   <span class="c1">#atable.units[len(atable)-1]   = &quot;&quot;</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No Line Cubes were computed from the input cube&lt;/h4&gt;&quot;</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tablestr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;pvcorr_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pvcorr&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="n">image</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">thumb</span>    <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">caption</span>  <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
               <span class="n">pvcorrname</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> 
               <span class="n">specval</span> <span class="o">=</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span> <span class="o">+</span> <span class="n">ENDROW</span>
               <span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> output for </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">pvcorrname</span><span class="p">)</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">specval</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No PV correlation diagrams were computed from the input cube&lt;/h4&gt;&quot;</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">specval</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="c1"># @todo move table formatting to here.</span>
        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;smooth_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;smooth&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="n">smoothname</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># output bdp name</span>
               <span class="n">enclosed</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># smooth to enclosing beam? True/False</span>
               <span class="n">bmaj</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
               <span class="n">bmin</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">180.0</span><span class="o">*</span><span class="mf">3600.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
               <span class="n">bpa</span>  <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
               <span class="n">velres</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
               <span class="n">beam</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%5.2f</span><span class="se">\&quot;</span><span class="s2"> x </span><span class="si">%5.2f</span><span class="se">\&quot;</span><span class="s2"> PA @ </span><span class="si">%5.2f</span><span class="s2"> deg&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bmaj</span><span class="p">,</span><span class="n">bmin</span><span class="p">,</span><span class="n">bpa</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">beam</span> <span class="o">=</span> <span class="n">velres</span> <span class="o">=</span> <span class="n">enclosed</span> <span class="o">=</span> <span class="n">smoothname</span>  <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
               <span class="c1">#topval +&quot;&lt;br&gt;&lt;h4&gt;No output from %s was registered?!&lt;/h4&gt;&quot;+ botval) % taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">smoothname</span><span class="p">,</span><span class="n">smoothname</span><span class="p">,</span><span class="n">enclosed</span><span class="p">,</span><span class="n">beam</span><span class="p">,</span><span class="n">velres</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;sfind2d_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sources&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#SummaryEntry</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no sources&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
                   <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                   <span class="n">multi_image</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">MultiImage</span><span class="p">()</span> 
                   <span class="n">multi_image</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                   <span class="n">aimage</span> <span class="o">=</span> <span class="n">multi_image</span><span class="o">.</span><span class="n">mimages</span><span class="p">[</span><span class="s2">&quot;finderimage&quot;</span><span class="p">]</span> <span class="c1">#klugey</span>
                   <span class="c1">#@todo Image.html()?</span>
                   <span class="n">imstr</span> <span class="o">=</span> <span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">aimage</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">PNG</span><span class="p">],</span> <span class="n">aimage</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">,</span> <span class="n">aimage</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">aimage</span><span class="o">.</span><span class="n">description</span><span class="p">,</span><span class="n">aimage</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no sources&lt;/h4&gt;&lt;br&gt;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span><span class="n">imstr</span><span class="p">)</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">imstr</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPANXVAL</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="n">ENDROW</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no sources&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tablestr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;overlapintegral_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="c1"># summary info format:</span>
               <span class="c1">#[table,image,thumb,caption]</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output.&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
                   <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output.&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">image</span> <span class="o">=</span> <span class="n">summarydata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                       <span class="n">thumb</span> <span class="o">=</span> <span class="n">summarydata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                       <span class="n">caption</span> <span class="o">=</span> <span class="n">summarydata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="n">SPANXVAL</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">))</span> 
                       <span class="n">imstr</span> <span class="o">=</span> <span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">)</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">imstr</span> <span class="o">+</span> <span class="n">ENDROW</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output.&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tablestr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;principalcomponent_at&quot;</span><span class="p">:</span>
        <span class="c1"># PCA returns two two tables in a list [[table1 h,u,d],[table2 h,u,d]].</span>
           <span class="n">tablestr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#SummaryEntry</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">summarydata</span><span class="p">:</span>
                      <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
                      <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                         <span class="n">tablestr</span> <span class="o">=</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="s2">&quot;&lt;h3&gt;No covariance data available for this summary. Try lowering &lt;i&gt;covarmin&lt;/i&gt; in the PrincipalComponent_AT task arguments.&lt;/h3&gt;&quot;</span>
                      <span class="k">else</span><span class="p">:</span>
                          <span class="n">tablestr</span> <span class="o">=</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span>

           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tablestr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;template_at&quot;</span><span class="p">:</span>
        <span class="c1"># Template returns one table (in a list) and two plots.</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#SummaryEntry</span>
           <span class="n">tablestr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
                   <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                     <span class="n">tablestr</span> <span class="o">=</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="s2">&quot;&lt;h3&gt;No data available for this summary.&lt;/h3&gt;&quot;</span>
                   <span class="k">else</span><span class="p">:</span>
                     <span class="n">tablestr</span> <span class="o">=</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>

           <span class="c1"># Output plots.</span>
           <span class="n">allspecs</span> <span class="o">=</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
           <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="c1"># task arguments are the same in all entries.</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spectra</span><span class="o">.</span><span class="n">getValue</span><span class="p">():</span>
                   <span class="c1"># default bootstrap width is 12 columns. We are using &#39;span4&#39; so</span>
                   <span class="c1"># thumbnail &#39;cell&#39; is 4 columns. Therefore, if we have more than </span>
                   <span class="c1"># 3 thumbnails, start a new row.</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                   <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                   <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                   <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

               <span class="n">banner</span> <span class="o">=</span> <span class="s1">&#39;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s1"> output for </span><span class="si">%s</span><span class="s1">&lt;/h4&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">,</span> <span class="n">casaimage</span><span class="p">)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;No spectra were produced by </span><span class="si">%s</span><span class="s2">&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>

           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;linesegment_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;segments&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no spectral lines in this cube&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
               <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> identified no spectral lines in this cube&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-admit table-bordered table-striped&quot;&#39;</span><span class="p">)</span>

           <span class="n">bigstr</span> <span class="o">=</span> <span class="s1">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">tablestr</span> <span class="o">+</span> <span class="n">ENDROW</span>
           <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="n">specval</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
           <span class="k">if</span> <span class="n">spectra</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spectra</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                   <span class="c1"># default bootstrap width is 12 columns. We are using &#39;span4&#39; so</span>
                   <span class="c1"># thumbnail &#39;cell&#39; is 4 columns. Therefore, if we have more than </span>
                   <span class="c1"># 3 thumbnails, start a new row.</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                   <span class="n">box</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                   <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                   <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                   <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                   <span class="n">casaimage</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imageIsSVG</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
                       <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPANSVGVAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">makesvghtml</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">caption</span><span class="p">,</span><span class="n">outdir</span><span class="p">)</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span> <span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>

                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
               <span class="n">bigstr</span> <span class="o">=</span> <span class="n">bigstr</span> <span class="o">+</span> <span class="n">STARTROW</span> <span class="o">+</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="n">ENDROW</span>
               <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">bigstr</span><span class="p">,</span> <span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;bdpingest_at&quot;</span><span class="p">:</span>
           <span class="n">the_item</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bdpingest&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#SummaryEntry</span>
           <span class="k">if</span> <span class="n">the_item</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">summarydata</span> <span class="o">=</span> <span class="n">the_item</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
               <span class="k">if</span> <span class="n">summarydata</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">summarydata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                   <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> No information available about the ingested BDP&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">atable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
                   <span class="n">atable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">summarydata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> No information available about the ingested BDP&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">tablestr</span> <span class="o">=</span> <span class="n">atable</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;class=&quot;table table-bordered table-striped&quot;&#39;</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">tablestr</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> No information available about the ingested BDP&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="n">taskname</span>
           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">the_item</span><span class="o">.</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">tablestr</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tlower</span> <span class="o">==</span> <span class="s2">&quot;generatespectrum_at&quot;</span><span class="p">:</span>
           <span class="n">spectra</span> <span class="o">=</span> <span class="n">titems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spectra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="c1"># task arguments are the same in all entries.</span>
               <span class="n">taskargs</span> <span class="o">=</span> <span class="n">spectra</span><span class="o">.</span><span class="n">taskargs</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
               <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spectra</span><span class="o">.</span><span class="n">getValue</span><span class="p">():</span>
                   <span class="c1"># default bootstrap width is 12 columns. We are using &#39;span4&#39; so</span>
                   <span class="c1"># thumbnail &#39;cell&#39; is 4 columns. Therefore, if we have more than </span>
                   <span class="c1"># 3 thumbnails, start a new row.</span>
                   <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">MAX_THUMBNAILS_PER_ROW</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                      <span class="n">specval</span> <span class="o">=</span> <span class="n">ENDROW</span> <span class="o">+</span> <span class="n">STARTROW</span>
                   <span class="k">else</span><span class="p">:</span> 
                      <span class="n">specval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                   
                   <span class="n">xlabel</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                   <span class="n">image</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                   <span class="n">thumb</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                   <span class="n">caption</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   <span class="n">specval</span> <span class="o">=</span> <span class="n">specval</span> <span class="o">+</span> <span class="p">(</span><span class="n">SPAN4VAL</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">thumb</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">caption</span><span class="p">))</span>
                   <span class="n">allspecs</span> <span class="o">=</span> <span class="n">allspecs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">specval</span>
                   <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

               <span class="n">banner</span> <span class="o">=</span> <span class="s1">&#39;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s1"> output&lt;/h4&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">)</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="n">banner</span> <span class="o">+</span> <span class="n">allspecs</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">allspecs</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;&lt;h4&gt;</span><span class="si">%s</span><span class="s2"> produced no output&lt;/h4&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskname</span><span class="p">)</span>

           <span class="n">retval</span> <span class="o">=</span> <span class="n">header</span> <span class="o">%</span> <span class="p">(</span><span class="n">taskclass</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span><span class="n">thetask</span><span class="o">.</span><span class="n">statusicons</span><span class="p">(),</span><span class="n">taskname</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="n">allspecs</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">topval</span> <span class="o">+</span> <span class="n">retval</span> <span class="o">+</span> <span class="n">botval</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;Summary</span><span class="se">\n</span><span class="s2">  metadata&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">print</span> <span class="n">k</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="nb">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  datatype</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">print</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  description</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">print</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize a new key and value. This method is typically used when</span>
<span class="sd">           loading in $ADMIT/etc/summary_defs.tab. See _startup()</span>
<span class="sd">           </span>
<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           key: str</span>
<span class="sd">              Key to set, case insensitive.  Key must not yet exist.</span>
<span class="sd">           value: list</span>
<span class="sd">              Entry to set, [value, description string]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s2">&quot;key </span><span class="si">%s</span><span class="s2"> already exists&quot;</span> <span class="o">%</span> <span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Input value does not contain instance of SummaryEntry&quot;</span>

    <span class="k">def</span> <span class="nf">_checklist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that a list contains only SummaryEntrys. If not,</span>
<span class="sd">           and exception is thrown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">badlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
           <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">SummaryEntry</span><span class="p">):</span>
              <span class="n">badlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
               
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">badlist</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Input value at index </span><span class="si">%s</span><span class="s2"> is not an instance of SummaryEntry&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">badlist</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called by __init___ to instantiate a new Summary from file $ADMIT/etc/summary_defs.tab&quot;&quot;&quot;</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">admit_root</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;etc&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;summary_defs.tab&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span> <span class="k">continue</span>
            <span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="n">valtype</span><span class="p">,</span><span class="n">description</span><span class="p">)</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">SummaryEntry</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span><span class="p">[</span><span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">valtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="p">[</span><span class="n">keyword</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">description</span>


    <span class="k">def</span> <span class="nf">_getitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;to allow iteration&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Self test&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tid</span><span class="o">=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;FITSNAME&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;foobar.fits&quot;</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span><span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;foobar.fits&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;CASANAME&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;foobar.im&quot;</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;TELESCOP&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;ALMA&quot;</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;PLUTO&quot;</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;NAXIS1&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;NAXIS2&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;NAXIS3&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">66</span><span class="p">,</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Ingest_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;PVSLICES&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">([[</span><span class="s2">&quot;slit&quot;</span><span class="p">,</span><span class="s2">&quot;sliceargs&quot;</span><span class="p">,</span><span class="s2">&quot;figname&quot;</span><span class="p">,</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">,</span><span class="s2">&quot;pvcaption&quot;</span><span class="p">,</span><span class="s2">&quot;overlayname&quot;</span><span class="p">,</span><span class="s2">&quot;overlaythumbname&quot;</span><span class="p">,</span><span class="s2">&quot;overlaycaption&quot;</span><span class="p">,</span><span class="s2">&quot;input_file&quot;</span><span class="p">]],</span><span class="s2">&quot;PVslice_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;MOMENTS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">SummaryEntry</span><span class="p">([</span>
                        <span class="p">[</span><span class="s1">&#39;H2CS_103.0405&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;blah_mom0.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 0 of H2CS&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom0&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;H2CS_103.0405&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;blah_mom1.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 1 of H2CS&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom1&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">]],</span> <span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Moment_AT&quot;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="n">tid</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;MOMENTS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">SummaryEntry</span><span class="p">([</span>
                        <span class="p">[</span><span class="s1">&#39;X2CS_103.0405&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;blah_mom0.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 0 of X2CS&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom0&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;X2CS_103.0405&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;blah_mom1.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 1 of X2CS&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom1&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">]],</span> <span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Moment_AT&quot;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="c1"># ensure replacement works</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;MOMENTS&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">SummaryEntry</span><span class="p">([</span>
                        <span class="p">[</span><span class="s1">&#39;Q_103.0405&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;blah_mom0.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 0 of Q&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom0_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom0&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">],</span> 
                        <span class="p">[</span><span class="s1">&#39;Q_103.0405&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;blah_mom1.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Moment 1 of Q&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;blah_mom1_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;histogram of mom1&#39;</span><span class="p">,</span> <span class="s1">&#39;blah.im&#39;</span> <span class="p">]],</span> <span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;Moment_AT&quot;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;These are some arguments&quot;</span><span class="p">))</span>

            <span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTaskID</span><span class="p">(</span><span class="s2">&quot;moments&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tid</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Expected MOMENT taskid </span><span class="si">%d</span><span class="s2">, got </span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tid</span><span class="p">,</span><span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># should throw exception: not an instance of SummaryEntry</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="s2">&quot;FOOBAR&quot;</span><span class="p">,[</span><span class="s2">&quot;foo.fits&quot;</span><span class="p">,</span><span class="s2">&quot;hey&quot;</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span>  
               <span class="nb">print</span> <span class="s2">&quot;## Couldn&#39;t add FOOBAR:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (It&#39;s OK, this is expected)&quot;</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTaskname</span><span class="p">(</span><span class="s2">&quot;fitsname&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tn</span> <span class="o">!=</span> <span class="s1">&#39;Ingest_AT&#39;</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">&quot;Expected taskname Ingest_AT, got </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">tn</span>

            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;chanrms&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">([</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;foobar.im&#39;</span><span class="p">],</span> <span class="s1">&#39;CubeStats_AT&#39;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;chanrms&quot;</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">([</span><span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;co-1.im&#39;</span><span class="p">],</span> <span class="s1">&#39;MARC1_AT&#39;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;chanrms&quot;</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">([</span><span class="mf">0.04</span><span class="p">,</span> <span class="s1">&#39;co-2.im&#39;</span><span class="p">],</span> <span class="s1">&#39;MARC2_AT&#39;</span><span class="p">,</span> <span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;cubesum&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">([</span><span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csm.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csm_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Integral (moment 0) of all emission in image cube ngc253_fullcube_compact_spw3_clean.ce.csm.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csm_histo.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csm_histo_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Histogram of cube sum for image cube ngc253_fullcube_compact_spw3_clean.ce.csm.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.im&#39;</span><span class="p">],</span><span class="s2">&quot;CubeSum_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;spectra&quot;</span><span class="p">,</span> <span class="n">SummaryEntry</span><span class="p">([</span>\
    <span class="p">[</span><span class="mi">184</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;184,150,184,150&#39;</span><span class="p">,</span> <span class="s1">&#39;Channel&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_0.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_0_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Spectrum in ngc253_fullcube_compact_spw3_clean.ce.im at centerbox[[184pix,150pix],[1pix,1pix]]&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.im&#39;</span><span class="p">],</span>\
    <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="s1">&#39;124,120,284,120&#39;</span><span class="p">,</span> <span class="s1">&#39;Channel&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_1.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_1_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Spectrum in ngc253_fullcube_compact_spw3_clean.ce.im at centerbox[[120pix,120pix],[1pix,1pix]]&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.im&#39;</span><span class="p">],</span>\
    <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;124,120,284,120&#39;</span><span class="p">,</span> <span class="s1">&#39;Channel&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_2.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_2_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Spectrum in ngc253_fullcube_compact_spw3_clean.ce.im at centerbox[[100pix,100pix],[1pix,1pix]]&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.im&#39;</span><span class="p">],</span>\
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;124,120,284,120&#39;</span><span class="p">,</span> <span class="s1">&#39;Channel&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_3.png&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.csp_3_thumb.png&#39;</span><span class="p">,</span> <span class="s1">&#39;Average Spectrum in ngc253_fullcube_compact_spw3_clean.ce.im at centerbox[[10pix,10pix],[1pix,1pix]]&#39;</span><span class="p">,</span> <span class="s1">&#39;ngc253_fullcube_compact_spw3_clean.ce.im&#39;</span><span class="p">]],</span>\
    <span class="s2">&quot;CubeSpectrum_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">tid</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="n">testlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">testtable</span> <span class="o">=</span> <span class="n">admit</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Table</span><span class="p">()</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="s2">&quot;{&#39;_type&#39;: &#39;Table&#39;, &#39;_order&#39;: [&#39;description&#39;, &#39;planes&#39;, &#39;units&#39;, &#39;data&#39;, &#39;columns&#39;], &#39;description&#39;: &#39;Identified Spectral Lines&#39;, &#39;planes&#39;: [], &#39;units&#39;: [&#39;GHz&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;km/s&#39;, &#39;K&#39;, &#39;K&#39;, &#39;D^2&#39;, &#39;Jy/beam&#39;, &#39;km/s&#39;, &#39;km/s&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;], &#39;data&#39;: [[101.89242, &#39;CH3CHO_101.89242&#39;, &#39;CH3CHOv=0&#39;, &#39;Acetaldehyde&#39;, &#39;3(1,3)-2(0,2)A++&#39;, 212.94533833637621, 2.772510051727295, 7.662539958953857, 2.297600030899048, -4.3369997478847351, -23.054661663623804, 59.015620206307695, 886, 899, -8324.4921623698665, 0], [101.96277, &#39;DNCO_101.96277&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=4-4&#39;, 0.0, 9.787079811096191, 14.680489540100098, 0.1711300015449524, 0, 0, 0, 0, 0, 0, 2], [101.96351, &#39;DNCO_101.96351&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=4-5&#39;, 0.0, 9.787079811096191, 14.680529594421387, 0.0017300000181421638, 0, 0, 0, 0, 0, 0, 2], [101.96369, &#39;DNCO_101.96369&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=6-5&#39;, 350.63413978966406, 9.787079811096191, 14.680540084838867, 5.056029796600342, 0.00084258543279315523, 114.63413978966406, 9.80037900830974, 830, 856, 1.6172691351514592, 2], [101.96369, &#39;DNCO_101.96369&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=5-4&#39;, 0.0, 9.787079811096191, 14.680540084838867, 4.106860160827637, 0, 0, 0, 0, 0, 0, 2], [101.96369, &#39;DNCO_101.96369&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=4-3&#39;, 0.0, 9.787079811096191, 14.680540084838867, 3.327440023422241, 0, 0, 0, 0, 0, 0, 2], [101.9644, &#39;DNCO_101.96440&#39;, &#39;DNCO&#39;, &#39;Isocyanic Acid&#39;, &#39;5(0,5)-4(0,4),F=5-5&#39;, 0.0, 9.787079811096191, 14.680569648742676, 0.17112000286579132, 0, 0, 0, 0, 0, 0, 2], [102.06427, &#39;NH2CHO_102.06427&#39;, &#39;NH2CHO&#39;, &#39;Formamide&#39;, &#39;5(1,5)-4(1,4)&#39;, 191.27283039192014, 12.78633975982666, 17.684619903564453, 62.7530403137207, 0.0028236083019267848, -44.727169608079862, 29.199261421990698, 788, 825, 5.4196694824471781, 0], [103.60365, &#39;H2CCCHCN_103.60365&#39;, &#39;H2CCCHCN&#39;, &#39;Cyanoallene&#39;, &#39;20(3,17)-19(3,16)&#39;, 106.59189789323986, 57.259681701660156, 62.231849670410156, 971.4053344726562, 0.0016086832366196001, -129.40810210676014, 36.665300323861935, 28, 34, 5.5723163322792049, 0], [103.64586, &#39;(CH2OH)2_103.64586&#39;, </span><span class="se">\&quot;</span><span class="s2">g&#39;Ga-(CH2OH)2</span><span class="se">\&quot;</span><span class="s2">, &#39;Ethylene Glycol&#39;, &#39;6(2,4)v=0-5(1,5)v=0&#39;, 170.05896720851203, 7.461170196533203, 12.43535041809082, 4.974090099334717, 0.0022648186040296948, -65.94103279148797, 23.762130083968334, 0, 13, 7.8451030069810663, 0]], &#39;columns&#39;: [&#39;frequency&#39;, &#39;uid&#39;, &#39;formula&#39;, &#39;fullname&#39;, &#39;transition&#39;, &#39;velocity&#39;, &#39;El&#39;, &#39;Eu&#39;, &#39;Linestrength&#39;, &#39;peakintensity&#39;, &#39;peakoffset&#39;, &#39;fwhm&#39;, &#39;startchan&#39;, &#39;endchan&#39;, &#39;sigma&#39;, &#39;blend&#39;]}&quot;</span>

            <span class="n">testtable</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">table_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">testtable</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span><span class="s2">&quot;LineID_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;vlsr=50&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;linelist&quot;</span><span class="p">,</span><span class="n">SummaryEntry</span><span class="p">(</span><span class="n">testtable</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span><span class="s2">&quot;LineID_AT&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=</span><span class="n">tid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;vlsr=50&quot;</span><span class="p">))</span>
            <span class="n">linenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLinenames</span><span class="p">()</span>
            <span class="n">testnames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;CH3CHO_101.89242&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;DNCO_101.96277&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;DNCO_101.96351&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;DNCO_101.96369&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;DNCO_101.96369&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;DNCO_101.96369&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;DNCO_101.96440&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;NH2CHO_102.06427&#39;</span><span class="p">,</span> 
                     <span class="c1">#&#39;NH2CHO_102.21757&#39;,</span>
                     <span class="c1">#&#39;CH3CH2CHO_102.46729&#39;, </span>
                     <span class="c1">#&#39;CH3CH2CHO_102.47868&#39;, </span>
                     <span class="c1">#&#39;CH3CCH_102.54798&#39;, </span>
                     <span class="c1">#&#39;CH2OHCHO_102.54978&#39;, </span>
                     <span class="c1">#&#39;H2CS_103.04055&#39;, </span>
                     <span class="c1">#&#39;CH2CHCHO_103.25137&#39;,</span>
                     <span class="c1">#&#39;(CH3)2CO_103.29717&#39;,</span>
                     <span class="c1">#&#39;(CH3)2CO_103.37708&#39;,</span>
                     <span class="c1">#&#39;CH3CH2OH_103.48036&#39;, </span>
                     <span class="c1">#&#39;CH3SH_103.50410&#39;,</span>
                     <span class="c1">#&#39;CH3COOH_103.54081&#39;,</span>
                     <span class="c1">#&#39;CH2CHCN_103.57540&#39;,</span>
                     <span class="s1">&#39;H2CCCHCN_103.60365&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;(CH2OH)2_103.64586&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">testnames</span> <span class="o">!=</span> <span class="n">linenames</span><span class="p">:</span>
               <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s2">&quot;Expected line names did not match.&quot;</span>
            <span class="k">return</span> <span class="kc">True</span>
            <span class="nb">print</span> <span class="n">s</span><span class="o">.</span><span class="n">getLinefluxes</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<span class="c1">###############################################################################</span>
<span class="c1">#    END SUMMARY CLASS                                                        #</span>
<span class="c1">###############################################################################</span>


<div class="viewcode-block" id="SummaryEntry"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry">[docs]</a><span class="k">class</span> <span class="nc">SummaryEntry</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Defines a single &#39;row&#39; of a Summary data entry.  A Summary key can refer to a list of SummaryEntry.</span>
<span class="sd">        This class makes management of complicated data entries easier.  It was getting tough</span>
<span class="sd">        to slice and unzip all those lists!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="p">[],</span><span class="n">taskname</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">taskid</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">taskargs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>    <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>    <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskname</span> <span class="o">=</span> <span class="n">taskname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span>   <span class="o">=</span> <span class="n">taskid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskargs</span> <span class="o">=</span> <span class="n">taskargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>     <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">SUMMARYENTRY</span>

<div class="viewcode-block" id="SummaryEntry.getValue"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.getValue">[docs]</a>    <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the underlying data value from this SummaryEntry.  Value will be list</span>
<span class="sd">           containing zero or more items.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           list</span>
<span class="sd">             A (possibly empty) list of SummaryEntry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span></div>


<div class="viewcode-block" id="SummaryEntry.getTaskname"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.getTaskname">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the task that created this SummaryEntry.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           str</span>
<span class="sd">             The string task name that produced the data value&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskname</span><span class="p">;</span></div>


<div class="viewcode-block" id="SummaryEntry.getTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.getTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the ID of the task that created this SummaryEntry.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           int</span>
<span class="sd">             The integer task ID that produced the data value&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span><span class="p">;</span></div>

<div class="viewcode-block" id="SummaryEntry.getTaskArgs"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.getTaskArgs">[docs]</a>    <span class="k">def</span> <span class="nf">getTaskArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the arguments of the task to display in the data browser web page.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           str </span>
<span class="sd">             The string task arguments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskargs</span><span class="p">;</span></div>



<div class="viewcode-block" id="SummaryEntry.setTaskname"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.setTaskname">[docs]</a>    <span class="k">def</span> <span class="nf">setTaskname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the name of the task that created this SummaryEntry.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           name : str </span>
<span class="sd">              The task name that produced the data value</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskname</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span></div>

<div class="viewcode-block" id="SummaryEntry.setTaskID"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.setTaskID">[docs]</a>    <span class="k">def</span> <span class="nf">setTaskID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">taskid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the ID of the task that created this SummaryEntry.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           taskid : int </span>
<span class="sd">              The task id number that produced the data value</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">=</span> <span class="n">taskid</span> <span class="p">;</span></div>

<div class="viewcode-block" id="SummaryEntry.setTaskArgs"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.setTaskArgs">[docs]</a>    <span class="k">def</span> <span class="nf">setTaskArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set any arguments of the task that should be displayed in the data browser web page.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           args : str </span>
<span class="sd">              The task args that produced the data value</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_taskargs</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span></div>

    <span class="c1">#-------------------------------</span>
    <span class="c1"># Make the internal data be well-behaved properties.</span>
    <span class="c1"># See e.g. http://www.programiz.com/python-programming/property</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getValue</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;The underlying data value&#39;</span><span class="p">)</span>
    <span class="n">taskname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getTaskname</span><span class="p">,</span> <span class="n">setTaskname</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;The name of the task that created this SummaryEntry&#39;</span><span class="p">)</span>
    <span class="n">taskid</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getTaskID</span><span class="p">,</span> <span class="n">setTaskID</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;The integer task ID that created this SummaryEntry&#39;</span><span class="p">)</span>
    <span class="n">taskargs</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getTaskArgs</span><span class="p">,</span> <span class="n">setTaskArgs</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;The arguments of the task to display in the data browser web page.&#39;</span><span class="p">)</span>
    <span class="c1">#-------------------------------</span>

<div class="viewcode-block" id="SummaryEntry.unset"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.unset">[docs]</a>    <span class="k">def</span> <span class="nf">unset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find out if this SummaryEntry instance has data or not.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           None</span>

<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">           bool</span>
<span class="sd">             True if this SummaryEntry has no data set&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_taskname</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="SummaryEntry.write"><a class="viewcode-back" href="../../module/admit/Summary.html#admit.Summary.SummaryEntry.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to write out the SummaryEntry data to XML</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            root : cElementTree node to attach to</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">snode</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="s2">&quot;summaryEntry&quot;</span><span class="p">)</span>
        <span class="n">snode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="n">bt</span><span class="o">.</span><span class="n">SUMMARYENTRY</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">XmlWriter</span><span class="o">.</span><span class="n">XmlWriter</span><span class="p">(</span><span class="bp">self</span><span class="p">,[</span><span class="s2">&quot;_value&quot;</span><span class="p">,</span><span class="s2">&quot;_taskname&quot;</span><span class="p">,</span><span class="s2">&quot;_taskid&quot;</span><span class="p">,</span><span class="s2">&quot;_taskargs&quot;</span><span class="p">],{</span><span class="s2">&quot;_value&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">LIST</span><span class="p">,</span><span class="s2">&quot;_taskname&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span><span class="s2">&quot;_taskid&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">INT</span><span class="p">,</span><span class="s2">&quot;_taskargs&quot;</span><span class="p">:</span><span class="n">bt</span><span class="o">.</span><span class="n">STRING</span><span class="p">},</span><span class="n">snode</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span></div>

    <span class="c1"># Two SummaryEntrys are equal if their taskids are equal</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)):</span>
           <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_taskid</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_taskid</span><span class="p">:</span>
               <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_taskid</span><span class="p">:</span>
               <span class="k">return</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_taskid</span><span class="p">:</span>
               <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SummaryEntry(value=</span><span class="si">%s</span><span class="s2">, taskname=</span><span class="si">%s</span><span class="s2">, taskid=</span><span class="si">%d</span><span class="s2">, taskargs=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_taskid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_taskargs</span><span class="p">)</span>
 
    <span class="c1"># ensure that printing a list of SummaryEntry will print the</span>
    <span class="c1"># individual values and not just addresses.  </span>
    <span class="c1"># e.g. &#39;print str(listOfSummaryEntry)&#39; does a useful and intuitive operation</span>
    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">_test</span><span class="p">()</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">SummaryEntry</span><span class="p">(</span><span class="s2">&quot;Hqwl&quot;</span><span class="p">,</span><span class="s2">&quot;AT1&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">SummaryEntry</span><span class="p">(</span><span class="s2">&quot;Hrwl&quot;</span><span class="p">,</span><span class="s2">&quot;AT1&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">SummaryEntry</span><span class="p">(</span><span class="s2">&quot;FOOS&quot;</span><span class="p">,</span><span class="s2">&quot;AT2&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">SummaryEntry</span><span class="p">(</span><span class="s2">&quot;FOOT&quot;</span><span class="p">,</span><span class="s2">&quot;AT3&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;qq == rr (True?):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qq</span> <span class="o">==</span> <span class="n">rr</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;qq == ss (True?):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qq</span> <span class="o">==</span> <span class="n">ss</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;ss == tt (False?):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qq</span> <span class="o">==</span> <span class="n">tt</span><span class="p">)</span>
    <span class="n">S1</span><span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">qq</span><span class="p">,</span><span class="n">rr</span><span class="p">,</span><span class="n">tt</span><span class="p">])</span>
    <span class="n">S2</span><span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">ss</span><span class="p">,</span><span class="n">tt</span><span class="p">])</span>
    <span class="nb">print</span> <span class="s2">&quot;S1=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;S2=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">S1</span><span class="p">:</span>
        <span class="n">S1</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
        <span class="n">S1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;S1u=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
    <span class="n">S3</span> <span class="o">=</span> <span class="n">S1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;union=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S3</span><span class="p">)</span>
    <span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">S3</span><span class="p">)</span>
    <span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">S3</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="nb">print</span> <span class="n">s</span><span class="o">.</span><span class="n">getAllTaskIDs</span><span class="p">()</span>
    <span class="nb">print</span> <span class="n">s</span><span class="o">.</span><span class="n">getTasknameForTaskID</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">ADMIT 1.0.6 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, The ADMIT Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>